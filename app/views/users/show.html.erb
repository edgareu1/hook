<div class="background-container">
  <canvas width="375" height="760" class="fish-tank" id="fishtank">
</div>

<div style="position: sticky">
  <div class="banner text-center" style="margin-bottom: 40px">
    <%= image_tag "avatar.jpg", class: "avatar-large", alt: "avatar-large" %>

    <h4 style=" color: rgba(255, 255, 255, 0.9); margin-bottom: 40px" >
      Welcome <%= current_user.username.capitalize %> !
    </h4>

    <%= link_to "Create", id: "modal-button", data: { toggle: "modal", target: "#ModalNewLog" },
        class: "btn btn-user-box" do %>
      <h6 style="padding-left: 10px">CREATE LOG</h6>

      <%= image_tag "rod.png", style:"width: 35px" %>
    <% end %>
  </div>

  <ul class="location-box" style="margin-bottom: 50px">
    <div style="display: flex; justify-content: space-between; align-items: center">
      <%= image_tag "chair.png", style:"width: 30px; padding-bottom: 5px" %>

      <h3 style="font-size: 22px">My Locations</h3>

      <%= link_to "Create", data: { toggle: "modal", target: "#ModalNewLocation" },
          style: "color: #BDEBFF; opacity: 0.7; padding-bottom: 5px" do %>
        <i class="fas fa-plus" style="font-size: 30px"></i>
      <% end %>
    </div>

    <% if @user_locations.empty? %>
      <p style="margin: 0">No locations saved yet</p>

    <% else %>
      <% current_user.top_locations(3).each do |location| %>
        <li style="list-style-type: none; display: flex; justify-content:center; align-items: center">
          <div style="width: 170px">
            <h6 style="text-align: left; margin: 10px 10px 0 0">
              <strong style="font-size: 20px">
                <%= location[:name] %>
              </strong>

              <% if location[:num_logs].zero? %>
                – no logs
              <% elsif location[:num_logs] == 1 %>
                – 1 log
              <% else %>
                <%= "– #{location[:num_logs]} logs" %>
              <% end %>
            </h6>

            <p style="color: #3AC4FF; font-style: italic; font-size: 18px; padding-left: 8px; margin-left: 10px; margin-bottom: 5px">
              <%= location[:site] %>
            </p>
          </div>

          <% weather_data = Rails.configuration.open_weather_api.current lon: location[:coordinates][:lon], lat: location[:coordinates][:lat] %>

          <div style="background-image: url(http://openweathermap.org/img/wn/<%= weather_data["weather"][0]["icon"] %>@2x.png); background-position: center; background-repeat: no-repeat; background-size: 58px 58px;-webkit-user-select: none; width: 70px; height: 35px">
          </div>
        </li>
      <% end %>
    <% end %>
  </ul>

  <!-- Feed box -->
  <ul class="feed" style="margin-bottom: 50px">
    <h5 style="text-align: center; padding-top: 10px">Did you know ?</h3>
    <p style="text-align: justify; padding: 0 10px"><%= @feed.sample %></p>
  </ul>

  <div class="user-info" style="margin-bottom: 40px">
    <div class="user-numbers">
      <div class="info-background">
        <%= current_user.logs.count %>
        <p>LOGS</p>
      </div>

      <div class="info-background">
        <%= current_user.catch_count %>
        <p>FISH</p>
      </div>
    </div>
  </div>
</div>

<ul class="top-fish d-flex justify-content-center"
    style="flex-direction: column; width: 250px; margin: auto; list-style-type: none; margin-bottom:30px">
  <h5 style="text-align:center">Most caught fish</h3>
  <% current_user.top_fish(3).each_with_index do |fish, index|  %>
    <li class=top-user>
      <p style="text-align:center; color: rgba(255, 255, 255, 0.9);">
        <%= "#{index + 1}." %> <i style="color:#9BDDF9"><%= "#{fish[:name]}" %></i> <%= "- #{fish[:num_catches]}" %>
      </p>
    </li>
  <% end %>
</ul>

<!-- Modals -->

<!-- Modal New Location Form -->
<div class="modal fade" id="ModalNewLocation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
       <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add location</h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <div class="modal-body">
        <%= render "locations/form" %>
      </div>
    </div>
  </div>
</div>

<!-- Modal New Log Form -->
<div class="modal fade" id="ModalNewLog" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" style="color: white; opacity: 0.9">New Log</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <div class="modal-body">
        <%= render "logs/form-new", log: Log.new %>
      </div>
    </div>
  </div>
</div>

<!-- Makes sure that, if an error appears while creating a new Location, the error is displayed to the user -->
<% if @location.errors.any? %>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelector('[data-target="#ModalNewLocation"]').click();
    });
  </script>
<% end %>
