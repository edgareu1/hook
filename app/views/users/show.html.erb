<!-- Canvas for the Background Fish Animations -->
<div class="background-container">
  <canvas width="375" height="760" class="fish-tank" id="fishtank">
</div>

<div style="position: sticky">
  <div class="banner text-center" style="margin-bottom: 40px">
    <%= large_avatar(current_user) %>

    <h4 style=" color: rgba(255, 255, 255, 0.9); margin: 15px 0 30px" >
      Welcome <%= current_user.username.capitalize %> !
    </h4>

    <%= link_to "Create", id: "modal-button", data: { toggle: "modal", target: "#ModalNewLog" },
        class: "btn btn-user-box" do %>
      <h6 style="padding-left: 10px">CREATE LOG</h6>

      <%= image_tag "rod.png", style:"width: 35px" %>
    <% end %>
  </div>

  <!-- User Top Locations -->
  <ul class="location-box">
    <div style="display: flex; justify-content: space-between; align-items: center">
      <%= image_tag "chair.png", style:"width: 30px; padding-bottom: 5px" %>

      <h3 style="font-size: 22px">My Locations</h3>

      <%= link_to "Create", data: { toggle: "modal", target: "#ModalNewLocation" },
          style: "color: #BDEBFF; opacity: 0.7; padding-bottom: 5px" do %>
        <i class="fas fa-plus" style="font-size: 30px"></i>
      <% end %>
    </div>

    <% if @user_locations.empty? %>
      <p style="padding: 10px; margin: 0">No locations saved yet</p>

    <% else %>
      <% current_user.top_locations(3).each do |location| %>
        <li>
          <div style="width: 170px">
            <h6 style="text-align: left; margin: 10px 10px 0 0">
              <strong style="font-size: 20px">
                <%= location[:name] %>
              </strong>

              <% if location[:num_logs].zero? %>
                – no logs
              <% elsif location[:num_logs] == 1 %>
                – 1 log
              <% else %>
                <%= "– #{location[:num_logs]} logs" %>
              <% end %>
            </h6>

            <p class="loc-site" style="font-size: 18px; margin: 0 0 5px 18px">
              <%= location[:site] %>
            </p>
          </div>

          <div style="background-image: url(http://openweathermap.org/img/wn/<%= location[:weather_icon] %>@2x.png);
               width: 70px; height: 35px; background-size: 58px 58px" class="weather-icon">
          </div>
        </li>
      <% end %>
    <% end %>
  </ul>

  <!-- Feed of Curiosities -->
  <ul class="feed">
    <h5>Did you know ?</h3>
    <p><%= @feed.sample %></p>
  </ul>

  <!-- User Stats -->
  <div class="user-stats">
    <div>
      <%= current_user.logs.count %>
      <p>LOGS</p>
    </div>

    <div>
      <%= current_user.catch_count %>
      <p>FISH</p>
    </div>
  </div>

  <!-- User Top Fish Caught -->
  <% unless @top_fish.empty? %>
    <ul class="top-fish">
      <h5 style="text-align:center">Most caught fish</h3>
      <% @top_fish.each_with_index do |fish, index|  %>
        <li>
          <p><%= "#{index + 1}." %> <i style="color:#9BDDF9"><%= "#{fish[:name]}" %></i> <%= "- #{fish[:num_catches]}" %></p>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>

<!-- Modals -->

<!-- Modal New Location Form -->
<div class="modal fade" id="ModalNewLocation">
  <%= render "locations/form-new" %>
</div>

<!-- Modal New Log Form -->
<div class="modal fade" id="ModalNewLog" role="dialog">
  <%= render "logs/form-new", log: Log.new %>
</div>

<!-- Makes sure that, if an error appears while creating a new Location, the error is displayed to the user -->
<% if @location.errors.any? %>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelector('[data-target="#ModalNewLocation"]').click();
    });
  </script>
<% end %>
