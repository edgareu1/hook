<div class="background-container"><canvas width="375" height="760" class="fish-tank" id="fishtank"></div>
<div style="position: sticky">
<div class="banner text-center">
  <%= image_tag "avatar.jpg", class: "avatar-large", alt: "avatar-large" %>
  <h4 >Welcome <%= current_user.username.capitalize%> !</h4>



      <%= link_to "Create", id: "modal-button", data: { toggle: "modal", target: "#ModalNewLog" }, class: "btn btn-user-box"  do %>
        <h6 style="padding-left: 10px">CREATE LOG</h6>
        <%= image_tag "rod.png", style:"width: 35px" %>
      <% end %>


  <ul class="location-box">
    <div style="display: flex; justify-content: space-between; align-items: center">
      <%= image_tag "chair.png", style:"width: 30px; padding-bottom: 5px" %>
      <h3 style="font-size: 22px">My Locations</h3>


      <%= link_to "Create", data: { toggle: "modal", target: "#ModalCreateLocation" }, style: "color: #BDEBFF; opacity: 0.7; font-size:12px; padding-bottom: 5px" do %>
        <i class="fas fa-plus" style="font-size: 30px"></i>
      <% end %>
    </div>

    <% if current_user.locations.empty? %>
      <p style="margin: 0">No locations saved yet</p>

    <% else %>
      <% current_user.locations.to_a.sort_by { |location| location.logs.count }.reverse[0..2].each do |location| %>
        <li>
          <div style="display: flex; justify-content: space-between">
            <h6 style="font-size: 16px; margin: 6px 10px 0 0">
              <% if location.logs.count.zero? %>
                (no logs)
              <% elsif location.logs.count == 1%>
                (1 log)
              <% else %>
                <%= "(#{location.logs.count} logs)" %>
              <% end %>

              <strong style="font-size: 18px"><%= location.name.match(/^[^,]*/)[0].truncate(18) %></strong>
            </h6>

            <% weather_data = Rails.configuration.open_weather_api.current lon: location.longitude , lat: location.latitude %>

            <div style="background-image: url(http://openweathermap.org/img/wn/<%= weather_data["weather"][0]["icon"] %>@2x.png); background-position: center; background-repeat: no-repeat; background-size: 58px 58px;-webkit-user-select: none; width: 70px; height: 35px">
            </div>
          </div>

          <h6 style="font-size: 16px; margin-left: 10px; font-weight: 400">- <%= location.site %></h6>
        </li>
      <% end %>
    <% end %>
  </ul>

  <ul class="feed">
      <h5 style="text-align:center; padding-top: 10px">Did you know ?</h3>
      <p style="text-align:center">Test test test test test test test test test test Test test test test test test test test test test</p>
  </ul>

    <div class="user-info">
    <div class="user-numbers">
      <div class="info-background">
        <%= current_user.logs.count %>
        <p>LOGS</p>
      </div>
      <div class="info-background">
        <%= current_user.catches.count %>
        <p>FISH</p>
      </div>
    </div>
  </div>
</div>

<div class="d-flex justify-content-center">
  <ul class="top-fish" style="width: 250px; list-style-type: none; margin-bottom:30px">
      <h5 style="text-align:center">Most caught fish</h3>
      <li class=top-user><p style="text-align:center">1. Fish name - Number of catch</p></li>
      <li class=top-user><p style="text-align:center">2. Fish name - Number of catch</p></li>
      <li class=top-user><p style="text-align:center">3. Fish name - Number of catch</p></li>
  </ul>
  </div>


</div>
</div>



<!-- Modal Create Location Form -->
<div class="modal fade" id="ModalCreateLocation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
       <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add location</h5>

        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <%= render "locations/form", location: Location.new %>
      </div>
    </div>
  </div>
</div>

<!-- Modal Create Log Form -->
<div class="modal fade" id="ModalNewLog" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" style="color: #010038">New Log</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <%= render "logs/form-new", log: Log.new %>
      </div>
    </div>
  </div>
</div>
