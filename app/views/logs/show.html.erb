<div style="margin: 20px">
  <h1><%= "#{@log.location.name} \##{sprintf '%04d', (current_user.logs.to_a.select { |log| log.location == @log.location }.find_index(@log) + 1)}" %></h1>

  <!-- Date -->
  <div style="display: flex; margin: 20px 0">
    <% if @log.start_time.strftime('%Y-%m-%d') == @log.end_time.strftime('%Y-%m-%d') %>
      <i class="far fa-calendar-alt" style="font-size: 26px; margin-right: 10px"></i>
      <p style="margin: 0; font-size: 16px"> <%= "#{@log.start_time.strftime('%B %d, %Y')}" %>
        <span style="font-size: 14px; margin-left: 5px"> <%= "#{@log.start_time.strftime('%I:%M %p')} - #{@log.end_time.strftime('%I:%M %p')}" %> </span> </p>

    <% else %>
      <i class="far fa-calendar-alt" style="font-size: 42px; margin-right: 10px"></i>
      <div style="display: flex; flex-direction: column">
        <p style="margin: 0; font-size: 16px"> <%= "#{@log.start_time.strftime('%B %d, %Y')}" %>
          <span style="font-size: 14px; margin-left: 5px"> <%= "#{@log.start_time.strftime('%I:%M %p')}" %> </span></p>
        <p style="margin: 0; font-size: 16px"> <%= "#{@log.end_time.strftime('%B %d, %Y')}" %>
          <span style="font-size: 14px; margin-left: 5px"> <%= "#{@log.end_time.strftime('%I:%M %p')}" %> </span></p>
      </div>
    <% end %>
  </div>

  <!-- Optional: rating and observations -->
  <% unless @log.rating.nil? %>
    <p style="font-size: 16px"> <%= "Rating: #{@log.rating}/5" %> </p>
  <% end %>

  <% unless @log.observation.empty? %>
    <p style="font-size: 16px"> Observations: <span style="font-size: 14px"> <%= @log.observation %> </span> </p>
  <% end %>

  <!-- List of Catches -->
  <ul class="list-catches">
    <div style="display: flex; justify-content: space-between">
      <h3>Catches</h3>
      <%= link_to "Create", data: { toggle: "modal", target: "#ModalCreateCatch" }, style: "color: #010038" do %>
        <i class="fas fa-plus" style="font-size: 30px"></i>
      <% end %>
    </div>

    <% if @log.catches.empty? %>
      <p style="margin: 0"> Nothing caught </p>

    <% else %>
      <% @log.catches.each do |catch| %>
        <li>
          <%= link_to "Delete", data: { toggle: "modal", target: "#ModalDeleteCatch" } do %>
            <i class="far fa-trash-alt" style="font-size: 16px; color: #010038; margin-right: 5px"></i>
          <% end %>

          <%= "#{catch.quantity} #{catch.fish.common_name}" %>

          <% unless catch.weight.nil? %>
            <% if catch.weight < 1000 %>
              <%= "#{catch.weight} gr" %>
            <% else %>
              <%= "#{catch.weight / 1000} kg" %>
            <% end %>
          <% end %>
        </li>

        <!-- Modal Delete Catch Form -->
        <div class="modal fade" id="ModalDeleteCatch" role="dialog">
          <div class="modal-dialog">

            <div class="modal-content">
              <div style="text-align:center; width: 100%; padding: 10px">
                <h2 class="modal-title" style="color: #010038"> Delete Catch</h2>
                <p style="color: #010038; margin: 0; padding: 0; border: none">Are you sure you want to delete the catch?</p>
              </div>

              <div style="width: 80%; margin: auto; margin-bottom: 20px; height: 40px">
                <button type="button" class="btn-cancel-confirm" data-dismiss="modal">Cancel</button>
                <%= link_to "Delete", log_catch_path(@log, catch), method: :delete, class: "btn-delete-confirm" %>
              </div>
            </div>
          </div>
        </div>

      <% end %>
    <% end %>
  </ul>

  <!-- Pop-ups for Log: delete and edit -->
  <div style="width: 100%; padding: 5px 10px; display: flex; justify-content: flex-end">
    <%= link_to "Delete", data: { toggle: "modal", target: "#ModalDeleteLog" } do %>
      <i class="far fa-trash-alt" style="font-size: 26px; color: white"></i>
    <% end %>

    <%= link_to "Edit", data: { toggle: "modal", target: "#ModalEditLog" }, style: "margin-left: 15px" do %>
      <i class="far fa-edit" style="font-size: 26px; color: white"></i>
    <% end %>

    <%= link_to "Create", data: { toggle: "modal", target: "#ModalCreateLog" }, style: "margin-left: 15px" do %>
      <i class="fas fa-plus" style="font-size: 26px; color: white"></i>
    <% end %>
  </div>
</div>


<!-- Modals -->

<!-- Modal Create Catch Form -->
<div class="modal fade" id="ModalCreateCatch" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" style="color: #010038">New Catch</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <%= render "catches/form" %>
      </div>
    </div>
  </div>
</div>


<!-- Modal Delete Log Form -->
<div class="modal fade" id="ModalDeleteLog" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div style="text-align:center; width: 100%; padding: 10px">
        <h2 class="modal-title" style="color: #010038"> Delete Log</h2>
        <p style="color: #010038; margin: 0">Are you sure you want to delete the log?</p>
      </div>

      <div style="width: 80%; margin: auto; margin-bottom: 20px; height: 40px">
        <button type="button" class="btn-cancel-confirm" data-dismiss="modal">Cancel</button>
        <%= link_to "Delete", log_path(@log), method: :delete, class: "btn-delete-confirm" %>
      </div>
    </div>
  </div>
</div>

<!-- Modal Edit Log Form -->
<div class="modal fade" id="ModalEditLog" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" style="color: #010038">Edit Log</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <%= render "logs/form", log: @log %>
      </div>
    </div>
  </div>
</div>

<!-- Modal Create Log Form -->
<div class="modal fade" id="ModalCreateLog" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" style="color: #010038">New Log</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <%= render "logs/form", log: Log.new %>
      </div>
    </div>
  </div>
</div>
